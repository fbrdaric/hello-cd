version: v1.0
name: Initial Pipeline
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804
blocks:
  - name: Install deps
    task:
      jobs:
        - name: Bundle
          commands:
            - checkout
            - make bundle
    dependencies: []
  - name: Unit tests
    dependencies:
      - Install deps
    task:
      agent:
        machine:
          type: e1-standard-2
          os_image: ubuntu1804
      jobs:
        - name: Rails
          commands:
            - checkout
            - make rails
          parallelism: 5
  - name: Acceptance tests
    dependencies:
      - Install deps
      - Unit tests
    task:
      jobs:
        - name: Cucumber
          commands:
            - checkout
            - make cucumber
          parallelism: 4
